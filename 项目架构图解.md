# Sign-KID 项目架构图解

## 🎯 项目目标
**将文本/手语符号转换为3D手语动画**

---

## 📊 整体流程图

```
┌─────────────────────────────────────────────────────────────┐
│                    输入阶段                                  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  文本输入: "morgen kommt regen"                             │
│        或                                                     │
│  Gloss输入: ["MORGEN", "KOMMEN", "REGEN"]                   │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                  词汇表映射阶段                                │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  src_vocab.txt 或 text_src_vocab.txt                         │
│                                                               │
│  "MORGEN" → 索引 10                                          │
│  "KOMMEN" → 索引 8                                            │
│  "REGEN" → 索引 5                                             │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                  嵌入层（Embedding）                          │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  索引 → 词向量（512维）                                       │
│                                                               │
│  [10, 8, 5] → [[0.1, 0.3, ...], [0.2, 0.4, ...], ...]      │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│              Transformer编码器（Encoder）                     │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  输入: 词向量序列                                             │
│  处理: 自注意力机制 + 前馈网络                                │
│  输出: 编码后的特征向量（理解输入含义）                       │
│                                                               │
│  [512维向量序列] → [编码特征序列]                             │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│              扩散模型（Diffusion Model）                       │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  训练时：                                                      │
│  ┌─────────────────────────────────────┐                    │
│  │ 真实姿态 → 添加噪声 → 学习去噪       │                    │
│  └─────────────────────────────────────┘                    │
│                                                               │
│  推理时：                                                      │
│  ┌─────────────────────────────────────┐                    │
│  │ 纯噪声 → 逐步去噪 → 生成姿态序列    │                    │
│  └─────────────────────────────────────┘                    │
│                                                               │
│  输出: 3D骨架坐标序列（每帧150个关节值）                      │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                    输出阶段                                   │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  3D骨架坐标序列:                                              │
│  帧1: [x1, y1, z1, x2, y2, z2, ..., x50, y50, z50, counter]│
│  帧2: [x1, y1, z1, x2, y2, z2, ..., x50, y50, z50, counter]│
│  ...                                                          │
│  帧N: [x1, y1, z1, x2, y2, z2, ..., x50, y50, z50, counter]│
│                                                               │
│  → 可视化 → 手语动画视频                                       │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 训练流程详解

```
┌─────────────────────────────────────────────────────────────┐
│                    训练开始                                   │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  1. 加载数据                                                  │
│     - 读取src文件（输入序列）                                 │
│     - 读取trg文件（目标姿态）                                 │
│     - 构建词汇表                                              │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 构建模型                                                  │
│     - 初始化编码器                                            │
│     - 初始化扩散模型                                          │
│     - 设置优化器（Adam）                                      │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 训练循环（每个epoch）                                     │
│     ┌─────────────────────────────────────┐                  │
│     │ 对每个batch:                         │                  │
│     │                                      │                  │
│     │  a) 前向传播                         │                  │
│     │     - 编码输入序列                   │                  │
│     │     - 通过扩散模型生成姿态           │                  │
│     │                                      │                  │
│     │  b) 计算损失                         │                  │
│     │     - L1损失（主要）                 │                  │
│     │     - MSE损失（噪声）                 │                  │
│     │     - 速度损失（流畅性）             │                  │
│     │                                      │                  │
│     │  c) 反向传播                         │                  │
│     │     - 计算梯度                       │                  │
│     │     - 更新参数                       │                  │
│     │                                      │                  │
│     │  d) 记录日志                         │                  │
│     │     - 损失值                         │                  │
│     │     - DTW指标                         │                  │
│     └─────────────────────────────────────┘                  │
│                                                               │
│  4. 定期验证                                                  │
│     - 在验证集上评估                                          │
│     - 计算DTW指标                                            │
│     - 保存最佳模型                                            │
│                                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                    训练完成                                   │
│     - 保存最终模型                                            │
│     - 生成训练报告                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 🧩 核心组件关系图

```
                    ┌─────────────┐
                    │   Model     │  (主模型类)
                    │  (model.py) │
                    └──────┬──────┘
                           │
            ┌──────────────┼──────────────┐
            │              │              │
            ▼              ▼              ▼
    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
    │  Encoder    │ │  Diffusion  │ │  Embedding  │
    │(encoders.py)│ │(diffusion.py)│ │(embeddings) │
    └─────────────┘ └─────────────┘ └─────────────┘
            │              │              │
            │              │              │
            └──────────────┼──────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   Output    │
                    │  (3D姿态)   │
                    └─────────────┘
```

---

## 📦 数据格式示例

### 输入数据（src/gloss.txt）
```
REGEN KOMMEN MORGEN
HEUTE WETTER SCHOEN
WOLKE SONNE KLAR
```

### 目标数据（trg/skels.txt）
```
0.5 -0.3 0.2 0.1 0.4 -0.2 ... (150个值) 1.0
0.6 -0.2 0.3 0.2 0.5 -0.1 ... (150个值) 2.0
0.7 -0.1 0.4 0.3 0.6 0.0 ... (150个值) 3.0
...
```

### 文件列表（files/files.txt）
```
sequence_001
sequence_002
sequence_003
```

---

## 🎓 学习路径可视化

```
阶段1: 基础理解
    │
    ├─ 什么是手语生成？
    ├─ 输入输出是什么？
    └─ 整体流程是什么？
    │
    ▼
阶段2: 代码结构
    │
    ├─ __main__.py (入口)
    ├─ data.py (数据加载)
    ├─ model.py (模型定义)
    └─ training.py (训练流程)
    │
    ▼
阶段3: 核心算法
    │
    ├─ encoders.py (编码器)
    ├─ diffusion.py (扩散模型)
    └─ loss.py (损失函数)
    │
    ▼
阶段4: 实践
    │
    ├─ 修改配置
    ├─ 小规模训练
    └─ 分析结果
```

---

## 💡 关键概念速查

| 概念 | 简单解释 | 类比 |
|------|---------|------|
| **Gloss** | 手语符号 | 像拼音，但表示手势 |
| **3D骨架** | 人体关节的3D位置 | 像木偶的关节 |
| **Transformer** | 理解序列的神经网络 | 像能理解上下文的翻译器 |
| **扩散模型** | 通过去噪生成数据 | 像从模糊照片恢复清晰照片 |
| **DTW** | 评估序列相似度 | 像比较两个舞蹈动作的相似度 |

---

## 🚀 快速开始

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 准备数据（需要Phoenix14T数据集）
# 将数据放在 ./Data/ 目录下

# 3. 训练模型
python __main__.py train ./Configs/config.yaml

# 4. 测试模型
python __main__.py test ./Configs/config.yaml --ckpt ./Models/best.ckpt
```

---

这份图解文档配合详细解析文档，应该能帮助你全面理解这个项目！

